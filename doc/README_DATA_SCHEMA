== DataService Schema

The MacroDeck Services framework will feature one prominent service: DataService.
This service will provide all of the data abstraction stuff for widgets,
other services, and so on. It therefore must be flexible.

This document describes the local data source storage format, or database
schema as some people call it. DataService should be capable of communicating
with remote sites and understanding that data; this feature won't be covered
here. The only thing we're going to explain here is how we store data locally.

== Introduction

The database will store data in any number of formats. We need to anticipate
this, as well as offer some kind of support for unknown formats. But, we
also need to be able to store standard values. The schema must satisfy that.
It'd also be pretty nice if it supported tagging, categorization, and so on.

So, anyway. Here's what I'm thinking of:

== Data Table

This is the real meat and potatoes. It stores data for everything that needs
to store things.

[id (primary key)]           
	An ID for each entry in the table. Indexed by MySQL.

[datatype (string)]
	A UUID representing the type of data stored in the table.
	We will provide a list of default data types. Custom data
	types will need to be registered with us somehow, so we
	have a tab on who created what data types and such.

[datacreator (string)]
	A UUID that identifies the widget that created this piece
	of data. Using the DataService, a widget could ask for
	something along the lines of "all events created by this
	widget"

[dataid (string)]
	A UUID that is unique for every piece of data. This should
	be filled in automatically by DataService.

[grouping (string)]
	A UUID that identifies a set or grouping of data. This is
	meant for data that makes sense grouped. For example,
	all events belonging to a particular calendar might have the
	same grouping. For items that are not grouped, this may be
	be NULL.

[owner (string)]
	A UUID that identifies the person or group that owns this
	data object. This may be the creator (and probably is in
	most cases).

[creator (string)]
	A UUID that identifies the person or group that created this
	data object. This will never change, even if its ownership
	is transferred to another user/group. Ownership is in the
	sense of data ownership. For example, if I post a message
	somewhere, I own that. Let's say, for example, that an
	administrator wants to post my message on the front page.
	They generate a copy, and become the owner of that copy,
	though I am the creator. In 95% of cases, the owner and
	creator are the same person. The 5% of the time that a
	distinction is needed makes things extremely annoying when
	systems don't understand that.

[creation (integer)]
	A UNIX timestamp set when the data item is created. A UNIX
	timestamp is the number of seconds elapsed since Janurary 1st,
	1970, 12:00AM. This seems the most logical way to store a time,
	since it's extremely portable. It can be converted to a readable
	date in almost every programming language.

[tags (string)]
	A list of textual tags used for searching/indexing this data.
	These tags are seperated with commas. If you need to use a comma
	in a tag, then you are insane and are attempting to use tags for
	some reason we didn't intend.

[title (string)]
	The title of the data. It may or may not be set, since some data
	can't have a title. But it should be set whenever possible, for
	searching and indexing purposes.

[description (string)]
	The description of the data. Again, this may not be set for
	data that can't have a description.
	
[stringdata (string)]
	If we're storing string data, the string data will be kept here.

[integerdata (integer)]
	If we're storing integer data (numbers), the string data will be kept
	here.
	
[objectdata (string)]
	If we need to store complex data, such as hashes, structures, and so
	on, we will store them here in YAML format.
	
[read_permissions (string)]
	A UUID that defines what set of read permissions to apply to this item.
	If this is NULL, it will default to denying everybody, but since the
	user is always allowed to view their data, it will become owner-read
	only.
	
[write_permissions (string)]
	A UUID that defines what set of write permissions to apply to this item.
	If this is NULL, it will default to denying everybody, but since the
	user is always allowed to edit their data, it will become owner-write
	only.
	
== Permissions Table

This table contains a bunch of allow/deny definitions that might be applied
to data items. There will be defaults. It's also possible that a bunch of
data items will have the same permissions, so that's allowed.

[id (primary key)]
	An ID for each item in the table. Indexed by MySQL.

[creator (string)]
	A UUID that indicates the user/group that made the permission. If this
	is set to MacroDeck's creator UUID (see below), this permission will
	show up for everyone.
	
[permissionid (string)]
	A UUID, assigned to a set of permissions (those that should be applied
	at the same time)
	
[order (integer)]
	A number indicating the order the permissions should be tested in. The
	order is on a per-set basis. Permissions are ordered ascending, so a
	permission item with an order of 0 will execute first.

[action (enum: "allow" or "deny")]
	Sets whether or not this permission will be granting someone access or
	denying someone access.
	
[applyto (string)]
	A UUID that indicates what user/group will be affected by this allow/deny.
	There are of course going to be default groups.
	
[en_title (string)]
	A human readable title. So users which actually do make custom permissions
	know what they're for. Since we're planning for multilingual capabilities,
	we're prefixing this column with en_. In the future, there might be a
	de_title, es_title, fr_title, and so on. The main purpose for the language
	distinction is that the global (anyone can set) permissions will need to
	be multilingual in the future. I should also note that the first permission
	will be the one that defines the title for the entire set, so if somehow
	the titles get out of sync in a set, you won't notice.
	
== Default UUIDs

I figured that, since our data depends heavily on UUIDs, that I'd define a bunch
of default UUIDs for all of the different things that may need them. So, here
they are:

[MacroDeck Creator ID]
	7b7e7c62-0a56-4785-93d5-6e689c9793c9
	
	This ID is used to signify things that MacroDeck itself creates. It can be
	used anywhere a user is expected. Permissions with this Creator ID will show
	up to everyone.
	
[Registered Users Group]
	6df561e7-3653-441b-af1d-69a64022724b
	
	You should use this Group ID when you want to create a permission or something
	that applies to all registered users. It does not apply to guests.

[Guests Group]
	5c872308-4ab4-4e8b-ac50-1d7408b9f32c
	
	This ID applies ONLY to guests, that is, people who are not logged in. You'd use
	it in permissions and stuff where you want something to be visible (or not) to
	guests.

[Everyone Group]
	e09709cb-515b-4723-9119-8af627ac3608
	
	This ID should be used when you want to create a permission or something that
	applies to everybody, registered users and guests included.
	
== Permission Notes

The one thing that I did not make clear in any text above is how permissions apply
to you. The main thing is that you should *always* be able to view your own data.
Also, read and write permissions will be stored in the same table. 
