<% viewmode = :compact if local_assigns[:viewmode].nil? %>

<% if viewmode == :micro %>
	<li class="vevent<%= " #{css_class}" if local_assigns[:css_class] %>"><%= link_to h(event.summary), "#", :class => "summary" %></li>
<% elsif viewmode == :compact %>
    <li class="vevent <%= cycle("odd", "even") %>">
	<span class="comment">
	    <%= h(event.event_type) %>
	</span>
	<span class="summary">
	    <%= h(truncate(event.title)) %>
	</span>
	<span class="timeloc">
	    <span class="location">
		<% parent = DataObject.view("by_path", :startkey => event.parent, :limit => 1, :reduce => false, :include_docs => true) %>
		<% if parent.length == 1 %>
		    <% if parent[0]["couchrest-type"] == "Place" %>
			<%= link_to h(parent[0]["title"]), country_region_locality_place_path(country.id, region.id, locality.id, parent[0].id) %>
		    <% else %>
			<%= h(parent[0]["title"]) %>
		    <% end %>
		<% end %>
	    </span>
	    <span class="time">
		<%=h Time.parse(event.start_time).getlocal.strftime("%a @ %I:%M%P") %>
		<% unless event.end_time.nil? %>
		    &ndash;
		    <%= Time.parse(event.end_time).getlocal.strftime("%I:%M%P") %>
		<% end %>
	    </span>
	</span>
    </li>
<% elsif viewmode == :full %>
    <div class="vevent">
	<div style="width: 75%; float: left;">
	    <div>
		<% content_module h(event.summary), { :box_size => 75, :altbox => true, :class_name => "summary", :text => true, :buttons => [["edit", "#"]] } do %>
		    <% if event.description.empty? %>
			<p class="nodescription">There is no description for this event. <%= link_to "Please add one.", "#" %></p>
		    <% else %>
		        <%= auto_link(simple_format(h(event.description), :class => "description"),
			    :href_options => { :target => "_blank" }) %>
		    <% end %>

		    <dl>
			<dt>Start Time</dt>
			<dd>
			    <abbr class="dtstart" title="<%= event.start_time.getlocal.strftime("%Y-%m-%d %H:%M:%S") %>">
				    <%= event.start_time.strftime("%b %d, %Y") %>
				    <%= event.start_time.strftime("%I:%M%p").downcase %>
			    </abbr>
			</dd>

			<% if !event.no_end_time && !event.end_time.nil? %>
			    <dt>End Time</dt>
			    <dd>
				<abbr class="dtend" title="<%= event.end_time.getlocal.strftime("%Y-%m-%d %H:%M:%S") %>">
				    <%= event.end_time.strftime("%b %d, %Y") %>
				    <%= event.end_time.strftime("%I:%M%p").downcase %>
				</abbr>
				<span class="approximation">(<%= distance_of_time_in_words(event.start_time.getlocal, event.end_time.getlocal, false) %> later)</span>
			    </dd>
			<% end %>
		    </dl>
		<% end %>
	    </div>
	    <% content_module "Wall", { :box_size => 75 } do %>
		<p>Wall goes here</p>
	    <% end %>
	</div>
	<div style="width: 25%; float: left;">
	    <% content_module "Location", { :box_size => 25, :altbox => true, :text => true } do %>
		<div class="location">
		    <% if @place %>
			<%= render :partial => "places/place", :object => @place %>
		    <% end %>
		</div>
	    <% end %>
	    <% content_module "Attendees", { :box_size => 25 } do %>
		<p>Placeholder.</p>
		<p>Placeholder.</p>
		<p>Placeholder.</p>
		<p>Placeholder.</p>
		<p>Placeholder.</p>
		<p>Placeholder.</p>
		<p>Placeholder.</p>
		<p>Placeholder.</p>
		<p>Placeholder.</p>
		<p>Placeholder.</p>
		<p>Placeholder.</p>
		<p>Placeholder.</p>
		<p>Placeholder.</p>
	    <% end %>
	</div>
    </div>
<% end %>
